# ğŸ¯ Coore

[![Flutter](https://img.shields.io/badge/Flutter-3.10+-blue.svg)](https://flutter.dev/)
[![Dart](https://img.shields.io/badge/Dart-3.10+-blue.svg)](https://dart.dev/)
[![License](https://img.shields.io/badge/License-MIT-blue.svg)](./LICENSE)

**Enterprise-grade Flutter infrastructure package** built on Clean Architecture principles with functional error handling and centralized configuration.

---

## âœ¨ Features

- ğŸ—ï¸ **Clean Architecture** - Strict separation of concerns with feature-first organization
- ğŸ”„ **Functional Error Handling** - Type-safe error handling with `fpdart`'s `Either` monad
- ğŸŒ **Networking** - Dio-based API handler with automatic token refresh and request cancellation
- ğŸ“Š **State Management** - Simplified BLoC/Cubit patterns with automatic API state handling
- ğŸ¨ **UI Components** - Production-ready widgets for pagination, forms, images, and theming
- ğŸ§­ **Navigation** - GoRouter integration with type-safe route generation support
- ğŸ’¾ **Storage** - Local (Hive) and secure (FlutterSecureStorage) database abstractions
- âš™ï¸ **Centralized Configuration** - Single entry point for app-wide setup

---

## ğŸ“¦ Installation

Add `coore` to your `pubspec.yaml`:

```yaml
dependencies:
  coore: ^1.0.0
```

Then run:

```bash
flutter pub get
```

---

## ğŸš€ Quick Start

### Critical Setup: Initialize Core Dependencies

**Coore requires initialization before `runApp()`**. This single call configures networking, theming, localization, and environment settings.

```dart
import 'package:coore/coore.dart';
import 'package:flutter/material.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  
  // Initialize all core dependencies
  await CoreConfig.initializeCoreDependencies(
    CoreConfigEntity(
      currentEnvironment: CoreEnvironment.development,
      networkConfigEntity: NetworkConfigEntity(
        baseUrl: 'https://api.example.com',
        connectTimeout: const Duration(seconds: 30),
        sendTimeout: const Duration(seconds: 30),
        receiveTimeout: const Duration(seconds: 30),
        authInterceptorType: AuthInterceptorType.tokenBased,
      ),
      localizationConfigEntity: LocalizationConfigEntity(
        defaultLocale: const Locale('en'),
        supportedLocales: const [Locale('en'), Locale('ar')],
        localizationsDelegates: [
          // Your localization delegates
        ],
      ),
      themeConfigEntity: ThemeConfigEntity(
        lightTheme: ThemeData.light(),
        darkTheme: ThemeData.dark(),
      ),
    ),
  );
  
  runApp(MyApp());
}
```

**After project setup** (e.g., after initializing Hive boxes), initialize navigation:

```dart
await CoreConfig.initializeCoreDependenciesAfterProjectSetup(
  CoreConfigAfterProjectSetupEntity(
    navigationConfigEntity: NavigationConfigEntity(
      routes: $appRoutes, // Generated by go_router_builder
      redirect: (context, state) {
        // Your redirect logic
        return null;
      },
    ),
  ),
);
```

---

## ğŸ“š Module Guide

### ğŸŒ Networking

Coore provides a type-safe API handler that wraps all network calls in `Either<NetworkFailure, T>`, enabling functional error handling.

#### Making API Requests

```dart
import 'package:coore/coore.dart';
import 'package:get_it/get_it.dart';

final apiHandler = getIt<ApiHandlerInterface>();

// GET request with cancellation support
final result = await apiHandler.get<List<User>>(
  '/users',
  parser: (json) => (json['data'] as List)
      .map((item) => User.fromJson(item as Map<String, dynamic>))
      .toList(),
  queryParameters: {'page': 1, 'limit': 20},
  shouldCache: true,
  isAuthorized: true,
  requestId: 'fetch-users', // Optional: for cancellation
);

// Handle the Either result
result.fold(
  (failure) {
    // Handle error
    print('Error: ${failure.message}');
  },
  (users) {
    // Handle success
    print('Fetched ${users.length} users');
  },
);
```

#### Request Cancellation

```dart
import 'package:coore/coore.dart';

final cancelManager = getIt<CancelRequestManager>();

// Start a request with a requestId
apiHandler.get('/users', requestId: 'fetch-users', ...);

// Cancel it later
cancelManager.cancelRequest('fetch-users');
```

#### POST Request with Form Data

```dart
final formData = MultipartFormDataAdapter({
  'name': 'John Doe',
  'email': 'john@example.com',
  'avatar': File('/path/to/avatar.jpg'),
});

final result = await apiHandler.post<Map<String, dynamic>>(
  '/users',
  parser: (json) => json,
  formData: formData,
  onSendProgress: (progress) => print('Upload: ${(progress * 100).toInt()}%'),
  isAuthorized: true,
);
```

---

### ğŸ”„ State Management

Coore simplifies API state management with `ApiStateHostMixin` and `ApiStateHandler`, eliminating boilerplate in your Cubits.

#### ApiState

`ApiState<T>` is a sealed class with four variants:

```dart
@freezed
sealed class ApiState<T> with _$ApiState<T> {
  const factory ApiState.initial() = Initial;
  const factory ApiState.loading() = Loading;
  const factory ApiState.succeeded(T successValue) = Succeeded;
  const factory ApiState.failed(Failure failure, {VoidCallback? retryFunction}) = Failed;
}
```

#### Using ApiStateHostMixin

```dart
import 'package:coore/coore.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:freezed_annotation/freezed_annotation.dart';

part 'user_state.freezed.dart';

@freezed
class UserState with _$UserState {
  const factory UserState({
    @Default(ApiState.initial()) ApiState<List<User>> usersState,
    @Default(ApiState.initial()) ApiState<User?> currentUserState,
  }) = _UserState;
}

class UserCubit extends Cubit<UserState> with ApiStateHostMixin<UserState> {
  final UserRepository _repository;
  
  // Create handlers for each API state
  late final _usersHandler = createApiHandler<List<User>>(
    getApiState: (state) => state.usersState,
    setApiState: (state, apiState) => state.copyWith(usersState: apiState),
  );
  
  late final _currentUserHandler = createApiHandler<User?>(
    getApiState: (state) => state.currentUserState,
    setApiState: (state, apiState) => state.copyWith(currentUserState: apiState),
  );
  
  UserCubit(this._repository) : super(const UserState());
  
  Future<void> loadUsers() async {
    await _usersHandler.handleApiCall(
      apiCall: _repository.getUsers,
      params: PagePaginationParams(page: 1, limit: 20),
      onSuccess: (users) {
        print('Loaded ${users.length} users');
      },
      onFailure: (failure) {
        print('Failed: ${failure.message}');
      },
    );
  }
  
  Future<void> loadCurrentUser(String userId) async {
    await _currentUserHandler.handleApiCall(
      apiCall: (params) => _repository.getUserById(userId),
      params: NoParams(),
    );
  }
}
```

**Benefits:**
- âœ… Automatic loading/success/failure state management
- âœ… Built-in request cancellation
- âœ… Retry functionality
- âœ… Automatic cleanup on Cubit disposal

---

### ğŸ¨ UI Components

#### Pagination Widget

`CorePaginationWidget` provides a complete pagination solution with pull-to-refresh, load-more, skeleton loading, and error handling.

```dart
CorePaginationWidget<User, PageMeta>(
  paginationFunction: (batch, limit, {requestId}) async {
    return await userRepository.getUsers(
      PagePaginationParams(page: batch, limit: limit),
    );
  },
  paginationStrategy: const PaginationStrategy(
    initialBatch: 1,
    batchSize: 20,
  ),
  scrollableBuilder: (context, response, controller) {
    return ListView.builder(
      controller: controller,
      itemCount: response.data.length,
      itemBuilder: (context, index) {
        final user = response.data[index];
        return ListTile(
          title: Text(user.name),
          subtitle: Text(user.email),
        );
      },
    );
  },
  emptyBuilder: (context) => const Center(
    child: Text('No users found'),
  ),
)
```

#### Form Fields

```dart
// Text field with validation
CoreTextField(
  label: 'Email',
  validator: (value) => value?.isEmpty ?? true ? 'Required' : null,
  keyboardType: TextInputType.emailAddress,
)

// PIN/OTP field
CorePinCodeField(
  length: 6,
  onCompleted: (pin) => print('PIN: $pin'),
)
```

#### Image Widget

```dart
CoreImage.network(
  'https://example.com/image.jpg',
  width: 200,
  height: 200,
  placeholder: (context, url) => const CircularProgressIndicator(),
  errorWidget: (context, url, error) => const Icon(Icons.error),
)
```

---

### ğŸ§­ Navigation

Coore integrates with `go_router` and is designed to work seamlessly with `go_router_builder` for type-safe navigation.

```dart
// After initialization, access the router
final router = getIt<GoRouter>();

// Navigate from BLoCs/Services
router.push('/users/123');

// Show dialogs from BLoCs
final context = CoreRouter.rootNavigatorKey.currentContext!;
showDialog(context: context, builder: (context) => AlertDialog(...));
```

For type-safe navigation with `go_router_builder`, see the [Navigation Guide](docs/NAVIGATION_GUIDE.md).

---

### ğŸ’¾ Storage

#### Local Database (Hive)

```dart
// Get an instance with a named box name parameter
final localDb = getIt<NoSqlDatabaseInterface>(param1: 'userData');

// Initialize the Hive box
final initResult = await localDb.initialize();
initResult.fold(
  (failure) => print('Initialization failed: ${failure.message}'),
  (_) => print('Database initialized'),
);

// Save data
final saveResult = await localDb.save<String>('username', 'john_doe');
saveResult.fold(
  (failure) => print('Save failed: ${failure.message}'),
  (_) => print('Data saved'),
);

// Read data
final username = await localDb.get<String>('username');
username.fold(
  (failure) => print('Error: ${failure.message}'),
  (value) => print('Username: $value'),
);

// Close when done
await localDb.close();
```

#### Secure Storage

```dart
final secureDb = getIt<SecureDatabaseInterface>();

// Initialize
await secureDb.initialize();

// Write sensitive data
await secureDb.write('token', 'secret_token');

// Read
final token = await secureDb.read('token');
```

---

## ğŸ—ï¸ Architecture

Coore enforces **Clean Architecture** with a **feature-first** organization:

```
lib/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api_handler/          # Networking layer
â”‚   â”œâ”€â”€ state_management/      # BLoC state management
â”‚   â”œâ”€â”€ ui/                    # UI components
â”‚   â”œâ”€â”€ config/                # Configuration & DI
â”‚   â”œâ”€â”€ error_handling/        # Error handling & failures
â”‚   â”œâ”€â”€ local_storage/         # Data persistence
â”‚   â””â”€â”€ navigation/            # Routing
```

### Key Principles

1. **Separation of Concerns** - Each module has a single responsibility
2. **Dependency Injection** - GetIt-based service locator pattern
3. **Functional Error Handling** - `Either<Failure, T>` for type-safe error handling
4. **Immutable State** - Freezed-based state classes
5. **Type Safety** - Strong typing throughout the API

---

## ğŸ”§ Available Services

After initialization, the following services are available via `getIt`:

- `ApiHandlerInterface` - HTTP client
- `CancelRequestManager` - Request cancellation
- `NetworkStatusInterface` - Network connectivity monitoring
- `NoSqlDatabaseInterface` - Local storage (Hive) - Requires `param1: 'boxName'`
- `SecureDatabaseInterface` - Secure storage
- `ThemeCubit` - Theme management
- `LocalizationCubit` - Localization management
- `PlatformCubit` - Platform information
- `CoreLogger` - Logging service
- `CoreRouter` - Router manager
- `GoRouter` - Router instance

---

## ğŸ“– Additional Resources

- [Navigation Guide](docs/NAVIGATION_GUIDE.md) - Comprehensive navigation documentation


---

## ğŸ¤ Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

---


**Built with â¤ï¸ for the Flutter community**

